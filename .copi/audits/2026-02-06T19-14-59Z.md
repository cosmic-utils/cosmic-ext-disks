# Code Quality Audit — cosmic-ext-disks

**Timestamp:** 2026-02-06T19:14:59Z  
**Commit:** 3a2e6d25ebe4405cdf74a42f9401d461f09f1340  
**Branch:** feature/ui-refactor  
**Repository:** cosmic-utils/cosmic-ext-disks  
**Audit Scope:** Code quality, maintainability, and structural issues on current branch

---

## Executive Summary

This audit identifies **code quality and maintainability issues** in the current branch, focusing on:
- Poor module organization (legacy re-export modules)
- Unused internationalization strings (20+ unused keys)
- Code duplication and structural issues
- Overly large files (900+ lines)
- Missing abstractions and code smells

**Top Priorities:**
1. **19 unused i18n keys** — dead code in translation files reduces maintainability
2. **Legacy re-export modules** — `utils/mod.rs`, `disks/mod.rs` exist only to glob-export (anti-pattern)
3. **945-line volume_model.rs** — needs decomposition into logical sub-modules
4. **1503-line gpt.rs** — partition type catalog too large, needs data-driven approach
5. **Dead code attribute abuse** — `#[allow(dead_code)]` in ui.rs hides real issues

---

## Surface Map

### storage-ui (UI Application)
**Entrypoints:**
- [storage-ui/src/main.rs](storage-ui/src/main.rs) — Application bootstrap
- [storage-ui/src/app.rs](storage-ui/src/app.rs) — Legacy entry (deprecated by ui-refactor)

**Core Structure (post-refactor):**
- [storage-ui/src/ui/app/](storage-ui/src/ui/app/) — Application model (state, message, update, view, subscriptions)
- [storage-ui/src/ui/sidebar/](storage-ui/src/ui/sidebar/) — Navigation sidebar component
- [storage-ui/src/ui/volumes/](storage-ui/src/ui/volumes/) — Volume management UI (disk header, segments, actions)
- [storage-ui/src/ui/dialogs/](storage-ui/src/ui/dialogs/) — Dialog state and views
- [storage-ui/src/utils/](storage-ui/src/utils/) — Utility functions (segments computation, UI helpers)

**Critical Files:**
- [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) — 806 lines (largest)
- [storage-ui/src/ui/volumes/update/encryption.rs](storage-ui/src/ui/volumes/update/encryption.rs) — 498 lines
- [storage-ui/src/utils/segments.rs](storage-ui/src/utils/segments.rs) — 453 lines

### storage-dbus (DBus Abstraction)
**Public API:**
- [storage-dbus/src/lib.rs](storage-dbus/src/lib.rs) — Glob re-exports (anti-pattern)
- [storage-dbus/src/disks/mod.rs](storage-dbus/src/disks/mod.rs) — Glob re-exports (anti-pattern)

**Core Models:**
- [storage-dbus/src/disks/drive/](storage-dbus/src/disks/drive/) — Drive discovery, actions, SMART
- [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) — 944 lines (needs split)
- [storage-dbus/src/disks/volume.rs](storage-dbus/src/disks/volume.rs) — 629 lines (volume tree structures)

**Partition Types:**
- [storage-dbus/src/partition_types/gpt.rs](storage-dbus/src/partition_types/gpt.rs) — **1503 lines** (massive data catalog)
- [storage-dbus/src/partition_types/dos.rs](storage-dbus/src/partition_types/dos.rs) — 357 lines

---

## Findings (Prioritized Backlog)

### GAP-001: Unused i18n Keys (19 strings)
**Type:** Dead Code / Maintainability  
**Severity:** Medium  
**Impact:** Translation maintenance burden; confusion about actual UI strings; potential for outdated translations in Swedish/other languages.

**Evidence:**
Executed script checking all i18n keys against source code usage. Found 19 unused keys:

```
benchmark-disk
check
create
disk-usage
drive-settings
encryption
menu-disk
menu-image
menu-view
model
mount-options
mount-toggle
ownership
page-id
show-reserved
usage
uuid
view
volumes
welcome
```

**Location:**
- [storage-ui/i18n/en/cosmic_ext_disks.ftl](storage-ui/i18n/en/cosmic_ext_disks.ftl) (lines vary)
- [storage-ui/i18n/sv/cosmic_ext_disks.ftl](storage-ui/i18n/sv/cosmic_ext_disks.ftl) (lines vary)

**How Found:** `grep` search for `fl!("<key>")` patterns; none found in source.

**Suggested Fix:**
- Remove unused keys from both `en/` and `sv/` .ftl files
- Validate no dynamic key construction (e.g., `fl!(format!("...", key))`)
- Document remaining keys for future reference

**Acceptance Criteria:**
- [ ] All 19 unused keys removed from .ftl files
- [ ] Swedish translations also cleaned
- [ ] `cargo build` passes
- [ ] Manual UI walkthrough confirms no missing strings

---

### GAP-002: Legacy Re-Export Module Pattern
**Type:** Code Smell / Poor Structure  
**Severity:** Medium  
**Impact:** Violates Rust idioms; obscures actual module structure; makes API surface unclear; hinders refactoring.

**Evidence:**

**File:** [storage-ui/src/utils/mod.rs](storage-ui/src/utils/mod.rs)
```rust
mod segments;
mod ui;

pub use segments::*;
pub use ui::*;
```
This module exists **only** to glob-reexport. No logic, no types, just indirection.

**File:** [storage-dbus/src/lib.rs](storage-dbus/src/lib.rs)
```rust
pub use dbus::*;
pub use disks::*;
pub use format::*;
pub use options::*;
pub use partition_types::*;
pub use udisks_block_config::*;
pub use usage::*;
```
Entire crate public API is a flat namespace from glob exports.

**File:** [storage-dbus/src/disks/mod.rs](storage-dbus/src/disks/mod.rs) (lines 12-21)
```rust
pub use create_partition_info::*;
pub use drive::*;
pub use gpt::*;
pub use image::*;
pub use lvm::*;
pub use manager::*;
pub use smart::*;
pub use volume::*;
pub use volume_model::{VolumeModel, VolumeType};
```

**Why This Is Bad:**
- Makes it impossible to understand where types actually come from
- Pollutes namespace with all symbols
- Makes API versioning/deprecation difficult
- IDE autocomplete becomes noisy
- Violates Rust's module system design (explicit is better than implicit)

**Suggested Fix:**
1. **For `storage-ui/src/utils/mod.rs`:**
   - Either inline the modules into calling sites OR
   - Keep the module but use explicit re-exports:
     ```rust
     pub use segments::{DiskSegment, DiskSegmentKind, PartitionExtent, SegmentComputation, SegmentAnomaly, compute_segments};
     pub use ui::{input_spinner, labelled_spinner, ...};
     ```

2. **For `storage-dbus/src/lib.rs`:**
   - Keep high-level types but use qualified paths:
     ```rust
     pub use disks::{DriveModel, VolumeModel, VolumeType, DiskManager};
     pub use partition_types::{PartitionTypeInfo, COMMON_GPT_TYPES, COMMON_DOS_TYPES};
     // etc.
     ```

3. **For `storage-dbus/src/disks/mod.rs`:**
   - Document the public API surface
   - Use explicit exports

**Acceptance Criteria:**
- [ ] No glob re-exports (`pub use module::*;`) remain
- [ ] Public API is documented
- [ ] `cargo doc` output is clean and navigable
- [ ] All callers updated (if needed)

---

### GAP-003: Overly Large File — volume_model.rs (944 lines)
**Type:** Poor Structure / Code Smell  
**Severity:** Medium  
**Impact:** Hard to navigate; mixes concerns (mounting, encryption, formatting, configuration); difficult to test individual behaviors.

**Evidence:**
- [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) — 944 lines
- Contains:
  - Type definitions (`VolumeModel`, `VolumeType`)
  - Mounting logic (`mount()`, `unmount()`)
  - Encryption operations (`unlock()`, `lock()`, `change_passphrase()`)
  - Filesystem operations (`format()`, `check_filesystem()`, `repair_filesystem()`, `edit_filesystem_label()`)
  - Configuration parsing (`get_mount_options_settings()`, `get_encryption_options_settings()`)
  - Partition editing (`edit_partition()`, `resize()`, `delete()`)
  - File I/O (`open_for_backup()`, `open_for_restore()`)
  - Tests

**Lines Breakdown:**
- Lines 1-100: Type definitions, from_proxy constructors
- Lines 200-400: Basic operations (mount, unmount, delete)
- Lines 400-600: Mount options parsing
- Lines 600-800: Encryption options
- Lines 800-945: Placeholder methods, tests

**Suggested Fix:**
Break into logical sub-modules within `disks/volume_model/`:

```
disks/volume_model/
  mod.rs           # VolumeModel struct + common methods
  types.rs         # VolumeType enum
  mount.rs         # mount(), unmount(), mount options parsing
  encryption.rs    # unlock(), lock(), change_passphrase(), encryption options
  filesystem.rs    # format(), check(), repair(), edit_label()
  partition.rs     # edit_partition(), resize(), delete()
  config.rs        # configuration parsing helpers
```

**Acceptance Criteria:**
- [ ] File split into < 300 line modules
- [ ] Each module has a clear single responsibility
- [ ] Public API unchanged (re-export from mod.rs)
- [ ] Tests moved to appropriate submodules
- [ ] `cargo test` passes

---

### GAP-004: Massive Partition Type Catalog — gpt.rs (1503 lines)
**Type:** Code Smell / Maintainability  
**Severity:** Medium  
**Impact:** Hard to maintain; error-prone; should be data-driven; adds compile time.

**Evidence:**
- [storage-dbus/src/partition_types/gpt.rs](storage-dbus/src/partition_types/gpt.rs) — **1503 lines**
- Contains ~150+ hardcoded `PartitionTypeInfo` structs
- Similar issue in [storage-dbus/src/partition_types/dos.rs](storage-dbus/src/partition_types/dos.rs) — 357 lines

**Sample from gpt.rs:**
```rust
pub const PARTITION_TYPE_GPT_LINUX_FILESYSTEM_DATA: PartitionTypeInfo = PartitionTypeInfo {
    partition_table: PartitionTable::GPT,
    type_guid: "0fc63daf-8483-4772-8e79-3d69d8477de4",
    name: "Linux filesystem",
    name_short: "Linux",
};
// ... repeated 150+ times
```

**Why This Is Bad:**
- Should be loaded from JSON/TOML/CSV at build time (or even runtime)
- Hard to audit for correctness
- No easy way to add new types without recompiling
- Duplicates data structure in code instead of data

**Suggested Fix:**
1. Convert to data file (e.g., `partition_types/gpt_types.toml`):
   ```toml
   [[types]]
   guid = "0fc63daf-8483-4772-8e79-3d69d8477de4"
   name = "Linux filesystem"
   name_short = "Linux"
   ```

2. Use `include_str!()` or `serde` at build time:
   ```rust
   const GPT_TYPES_DATA: &str = include_str!("gpt_types.toml");
   lazy_static! {
       pub static ref COMMON_GPT_TYPES: Vec<PartitionTypeInfo> = 
           toml::from_str(GPT_TYPES_DATA).unwrap();
   }
   ```

3. Or use code generation in `build.rs`

**Acceptance Criteria:**
- [ ] Partition types loaded from data file
- [ ] Code size reduced by >1000 lines
- [ ] Easy to add new types without code changes
- [ ] Runtime performance unchanged (lazy_static or build-time gen)

---

### GAP-005: Dead Code Attributes Hide Real Issues
**Type:** Code Smell / Technical Debt  
**Severity:** Low  
**Impact:** Masks unused code; prevents compiler from warning about genuine dead code.

**Evidence:**

**File:** [storage-ui/src/utils/ui.rs](storage-ui/src/utils/ui.rs) (line 1)
```rust
#![allow(dead_code)]
```
Entire module marked with blanket dead code allowance.

**Inspection:** Contains functions like `input_spinner`, `labelled_spinner`, custom styling functions. Many appear unused.

**Why This Is Bad:**
- If code is truly used, remove the attribute
- If code is unused, delete it or mark specific items
- Blanket allows prevent finding actually dead code

**Suggested Fix:**
1. Remove `#![allow(dead_code)]`
2. Run `cargo build` and check warnings
3. For each unused item, either:
   - Delete it (if truly unused)
   - Mark individual items with `#[allow(dead_code)]` and add a comment explaining why (e.g., "used in planned feature X")

**Acceptance Criteria:**
- [ ] No module-level `#![allow(dead_code)]`
- [ ] Individual items annotated with rationale
- [ ] Or all dead code removed

---

### GAP-006: Commented-Out Code — `edit_encrytion_options` Typo API
**Type:** Dead Code / Poor Design  
**Severity:** Low  
**Impact:** Backward-compat method that just returns error; should be removed or deprecated properly.

**Evidence:**

**File:** [storage-dbus/src/disks/volume_model.rs](disks-dbs/src/disks/volume_model.rs) (lines 866-872)
```rust
// Backwards-compat (typo in API): keep the old name but make it explicit.
pub async fn edit_encrytion_options(&self) -> Result<()> {
    Err(anyhow::anyhow!(
        "edit_encrytion_options() is deprecated; use edit_encryption_options(...)"
    ))
}
```

**Why This Is Bad:**
- If it's a public API, needs proper deprecation with `#[deprecated]`
- If it's not used, delete it
- Returning an error isn't a deprecation strategy — it's a runtime crash waiting to happen

**Suggested Fix:**
1. delete it and replace references.

**Acceptance Criteria:**
- [ ] Method deleted
- [ ] No callers use the typo name
- [ ] Release notes mention the fix

---

### GAP-007: `TODO` Comments Without Context (3 found)
**Type:** Technical Debt  
**Severity:** Low  
**Impact:** Unclear what needs to be done; no tracking of work.

**Evidence:**

**File:** [storage-dbus/src/partition_types/mod.rs](storage-dbus/src/partition_types/mod.rs) (line 55)
```rust
//TODO: wrap name with gettext call
```
No issue tracker reference, no explanation of why not done yet.

**File:** [storage-dbus/src/format.rs](storage-dbus/src/format.rs) (line 28)
```rust
let bytes_str = bytes.to_formatted_string(&Locale::en); //TODO: Accept locale as a parameter.
```

**File:** [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) (lines 646, 667, 875)
```rust
//TODO: implement. See how edit mount options -> User session defaults works in gnome-disks.
//TODO: implement. Look at gnome-disks -> partition -> edit mount options.
//TODO: implement. creates a *.img of self.
```

**Why This Is Bad:**
- No prioritization
- No tracking
- "TODO" grep becomes noise

**Suggested Fix:**
1. Convert to tracked issues:
   - Create GitHub issue for each
   - Replace `//TODO: X` with `//TODO(DSK-###): X` or remove comment

2. Or delete if not actionable

**Acceptance Criteria:**
- [ ] All TODOs either removed, linked to issues, or have clear context
- [ ] Project convention documented for future TODOs

---

### GAP-008: Excessive `.clone()` in Closures
**Type:** Performance / Code Smell  
**Severity:** Low  
**Impact:** Unnecessary clones can hurt performance; indicates structural issues with ownership.

**Evidence:**

**File:** [storage-ui/src/ui/dialogs/view/image.rs](storage-ui/src/ui/dialogs/view/image.rs) (line 151)
```rust
text_input(path_label.clone(), state.image_path.clone())
```
Back-to-back clones of the same pattern suggests poor data flow.

**Search Results:** Only 1 egregious case found, but pattern worth watching.

**Suggested Fix:**
- Review if clones are necessary
- Consider using references or restructuring to avoid double-cloning

**Acceptance Criteria:**
- [ ] Review clone usage in hot paths
- [ ] Document intentional clones (if needed for closure capture)

---

### GAP-010: Commented-Out Debugging Code
**Type:** Code Smell  
**Severity:** Low  
**Impact:** Clutter; suggests incomplete refactoring.

**Evidence:**

**File:** [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) (line 289)
```rust
println!("{type_str}");
```
Debug print statement left in production code.

**Suggested Fix:**
- Delete if not needed
- Replace with proper `tracing::debug!()` call if diagnostic is useful

**Acceptance Criteria:**
- [ ] No `println!` or `dbg!` in non-test code
- [ ] Use `tracing` for diagnostics

---

### GAP-011: Module Structure Inconsistency — `/drive/mod.rs` Pattern
**Type:** Code Smell / Inconsistency  
**Severity:** Low  
**Impact:** Inconsistent module organization makes navigation harder.

**Evidence:**

**Observation:** Some modules use the "folder with mod.rs" pattern:
- [storage-dbus/src/disks/drive/mod.rs](storage-dbus/src/disks/drive/mod.rs)
  - Sub-modules: `actions.rs`, `discovery.rs`, `model.rs`, `smart.rs`, `volume_tree.rs`
  - Exports: `pub use model::DriveModel;`

But most UI modules use explicit re-exports in parent:
- `storage-ui/src/ui/volumes/` has no `mod.rs`, just sibling files

**Mixed Patterns:**
- Some modules: `folder/mod.rs` + `folder/submod.rs`
- Other modules: `parent_mod.rs` declares `mod child;`

**Why This Matters:**
- Harder to know where to find module declarations
- Rust 2018 allows both styles, but consistency helps

**Suggested Fix:**
- Document preferred pattern in `.copi/repo-rules.md`
- Prefer "explicit sibling" style for small modules, "folder/mod.rs" for large hierarchies

**Acceptance Criteria:**
- [ ] Convention documented
- [ ] No action required if current mix is intentional, but document why

---

## Quick Wins

These can be fixed in <30 minutes each:

1. **Remove 19 unused i18n keys** (GAP-001) — straightforward deletion
2. **Delete or deprecate `edit_encrytion_options` typo method** (GAP-006) — one method
3. **Remove `println!` debug statement** (GAP-010) — one line
4. **Replace `unwrap()` with `expect()` in logging.rs** (GAP-009) — 9 lines

---

## Open Questions

1. **Is `utils/ui.rs` actually used?** — The `#![allow(dead_code)]` suggests not, but needs verification.
2. **Are partition types expected to be user-extensible?** — If yes, data-driven approach (GAP-004) is critical. If no, consider removing rare types.
3. **What is the long-term plan for `storage-ui/src/app.rs`?** — File still exists but likely deprecated by ui-refactor. Should it be deleted?
4. **Is `backing-file` i18n key intentionally unused?** — Found in .ftl but only used once. Potential for future feature or leftover?

---

## Appendix

### Notable Searches

- **TODO/FIXME/HACK:** Found 3 genuine TODOs, rest were false positives (`Debug` derive)
- **unwrap/expect/panic:** Found ~10 cases, mostly in non-critical paths (logging init)
- **Glob re-exports:** Found 3 modules using anti-pattern
- **File sizes:** 5 files over 400 lines; 2 over 900 lines

### Files Reviewed

**Full read:**
- [storage-ui/src/utils/mod.rs](storage-ui/src/utils/mod.rs)
- [storage-ui/src/utils/segments.rs](storage-ui/src/utils/segments.rs)
- [storage-ui/src/utils/ui.rs](storage-ui/src/utils/ui.rs)
- [storage-ui/src/logging.rs](storage-ui/src/logging.rs)
- [storage-dbus/src/lib.rs](storage-dbus/src/lib.rs)
- [storage-dbus/src/disks/mod.rs](storage-dbus/src/disks/mod.rs)
- [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) (partial)

**Scanned:**
- [storage-ui/src/ui/volumes/view.rs](storage-ui/src/ui/volumes/view.rs)
- [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs)
- [storage-dbus/src/partition_types/gpt.rs](storage-dbus/src/partition_types/gpt.rs)
- [storage-dbus/src/partition_types/dos.rs](storage-dbus/src/partition_types/dos.rs)

### Tools Used

- `grep -r` for pattern searching
- `wc -l` for line counting
- `find` for file enumeration
- Custom shell scripts for i18n key usage analysis

---

### GAP-012: Untranslated UI Strings (7 instances)
**Type:** Internationalization / Code Smell  
**Severity:** Medium  
**Impact:** English-only strings break localization; Swedish (and future language) users see mixed language UI; violates i18n best practices.

**Evidence:**

Found 7 hardcoded English strings that should use `fl!()` macro:

1. **"Not mounted" (3 occurrences)**
   - [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) lines 371, 497, 515
   ```rust
   widget::text::caption("Not mounted").into()
   ```

2. **"Can create partition"**
   - [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) line 787
   ```rust
   let available_text = widget::text::caption("Can create partition");
   ```

3. **"Offset: {}" format string**
   - [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) line 783
   ```rust
   let offset_text = widget::text::caption(format!(
       "Offset: {}",
       bytes_to_pretty(&segment.offset, false)
   ));
   ```

4. **"UUID: {}" format string**
   - [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) line 478
   ```rust
   let uuid_text = widget::text::caption(format!("UUID: {}", &p.uuid));
   ```
   **Note:** The key `uuid` exists in i18n but is unused (see GAP-001). Should be `format!("{}: {}", fl!("uuid"), &p.uuid)`.

5. **Volume type labels (4 strings)**
   - [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) lines 337-340
   ```rust
   VolumeKind::LvmLogicalVolume => "LVM LV".to_string(),
   VolumeKind::LvmPhysicalVolume => "LVM PV".to_string(),
   VolumeKind::CryptoContainer => "LUKS".to_string(),
   VolumeKind::Partition => "Partition".to_string(),
   ```

**Why This Is Bad:**
- Breaks the application's localization strategy
- Swedish users see English strings in their localized UI
- Inconsistent with rest of codebase (most strings use `fl!()`)
- Hard to find all translatable strings (some hardcoded, some in .ftl)

**Suggested Fix:**

1. Add missing keys to `storage-ui/i18n/en/cosmic_ext_disks.ftl`:
   ```fluent
   not-mounted = Not mounted
   can-create-partition = Can create partition
   offset = Offset
   lvm-logical-volume = LVM LV
   lvm-physical-volume = LVM PV
   luks-container = LUKS
   partition-type = Partition
   ```

2. Update code to use `fl!()`:
   ```rust
   // Line 371, 497, 515:
   widget::text::caption(fl!("not-mounted")).into()
   
   // Line 787:
   let available_text = widget::text::caption(fl!("can-create-partition"));
   
   // Line 783:
   let offset_text = widget::text::caption(format!(
       "{}: {}",
       fl!("offset"),  // Key exists but unused (GAP-001)
       bytes_to_pretty(&segment.offset, false)
   ));
   
   // Line 478:
   let uuid_text = widget::text::caption(format!("{}: {}", fl!("uuid"), &p.uuid));
   
   // Lines 337-340:
   VolumeKind::LvmLogicalVolume => fl!("lvm-logical-volume"),
   VolumeKind::LvmPhysicalVolume => fl!("lvm-physical-volume"),
   VolumeKind::CryptoContainer => fl!("luks-container"),
   VolumeKind::Partition => fl!("partition-type"),
   ```

3. Add Swedish translations to `storage-ui/i18n/sv/cosmic_ext_disks.ftl`

**Note:** This finding overlaps with GAP-001. Keys `offset` and `uuid` are marked as unused, but actually **should** be used in these locations. This reduces the unused key count from 19 to 17.

**Acceptance Criteria:**
- [ ] All hardcoded UI strings replaced with `fl!()` calls
- [ ] New i18n keys added to both `en/` and `sv/` translations
- [ ] Fix GAP-001 to recognize `offset` and `uuid` as used (not unused)
- [ ] Manual UI walkthrough in English and Swedish
- [ ] No visual regressions

---

## Quick Wins

These can be fixed in <30 minutes each:

1. **Remove 17 unused i18n keys** (GAP-001, adjusted for GAP-012) — straightforward deletion
2. **Delete or deprecate `edit_encrytion_options` typo method** (GAP-006) — one method
3. **Remove `println!` debug statement** (GAP-010) — one line
4. **Fix 3 "Not mounted" strings** (GAP-012) — add one key, 3 replacements
5. **Fix "UUID: {}" format** (GAP-012) — reuse existing unused key

---

## Open Questions

1. **Is `utils/ui.rs` actually used?** — The `#![allow(dead_code)]` suggests not, but needs verification.
2. **Are partition types expected to be user-extensible?** — If yes, data-driven approach (GAP-004) is critical. If no, consider removing rare types.
3. **What is the long-term plan for `storage-ui/src/app.rs`?** — File still exists but likely deprecated by ui-refactor. Should it be deleted?
4. **Should technical abbreviations (LVM, LUKS) be translated?** — These are standard terms across OSes. Consider keeping them as-is or making them configurable.

---

## Summary Statistics

- **Total findings:** 12
- **Critical/High:** 0
- **Medium:** 4 (GAP-001, GAP-002, GAP-003, GAP-012)
- **Low:** 8
- **Quick wins:** 5 (< 30 min each)
- **Unused i18n keys:** 17 (after accounting for GAP-012)
- **Untranslated strings:** 7 instances
- **Lines of oversized files:** 4,450+ (volume_model.rs + gpt.rs + app/view.rs)

---

## Appendix

### Notable Searches

- **TODO/FIXME/HACK:** Found 3 genuine TODOs, rest were false positives (`Debug` derive)
- **unwrap/expect/panic:** Found ~10 cases, mostly in non-critical paths (logging init)
- **Glob re-exports:** Found 3 modules using anti-pattern
- **File sizes:** 5 files over 400 lines; 2 over 900 lines
- **Hardcoded UI strings:** Found 7 instances across app/view.rs

### Files Reviewed

**Full read:**
- [storage-ui/src/utils/mod.rs](storage-ui/src/utils/mod.rs)
- [storage-ui/src/utils/segments.rs](storage-ui/src/utils/segments.rs)
- [storage-ui/src/utils/ui.rs](storage-ui/src/utils/ui.rs)
- [storage-ui/src/logging.rs](storage-ui/src/logging.rs)
- [storage-dbus/src/lib.rs](storage-dbus/src/lib.rs)
- [storage-dbus/src/disks/mod.rs](storage-dbus/src/disks/mod.rs)
- [storage-dbus/src/disks/volume_model.rs](storage-dbus/src/disks/volume_model.rs) (partial)

**Scanned:**
- [storage-ui/src/ui/volumes/view.rs](storage-ui/src/ui/volumes/view.rs)
- [storage-ui/src/ui/app/view.rs](storage-ui/src/ui/app/view.rs) — **untranslated strings found**
- [storage-dbus/src/partition_types/gpt.rs](storage-dbus/src/partition_types/gpt.rs)
- [storage-dbus/src/partition_types/dos.rs](storage-dbus/src/partition_types/dos.rs)

### Tools Used

- `grep -r` for pattern searching
- `wc -l` for line counting
- `find` for file enumeration
- Custom shell scripts for i18n key usage analysis
- Regex patterns for untranslated string detection

---

**End of Audit**
